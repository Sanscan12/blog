<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>若依框架 | 柏竹</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="https://image.bozhu12.cc/myblog/Essay/favicon.ico">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="学习足迹 , 记录生活!">
    <meta name="Sasncan12" content="柏竹博客, 个人技术博客, 前后端端 , 技术文档">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#bd93f9">
    
    <link rel="preload" href="/assets/css/0.styles.b41e82d5.css" as="style"><link rel="preload" href="/assets/js/app.19d69fa3.js" as="script"><link rel="preload" href="/assets/js/2.b26d2d6f.js" as="script"><link rel="preload" href="/assets/js/120.3df76986.js" as="script"><link rel="prefetch" href="/assets/js/10.7dcdd9e8.js"><link rel="prefetch" href="/assets/js/100.f3af5bda.js"><link rel="prefetch" href="/assets/js/101.73de88d8.js"><link rel="prefetch" href="/assets/js/102.ab0d9a73.js"><link rel="prefetch" href="/assets/js/103.d988423e.js"><link rel="prefetch" href="/assets/js/104.7e50c512.js"><link rel="prefetch" href="/assets/js/105.75883898.js"><link rel="prefetch" href="/assets/js/106.a31e9e94.js"><link rel="prefetch" href="/assets/js/107.3e237695.js"><link rel="prefetch" href="/assets/js/108.0fe1bdc4.js"><link rel="prefetch" href="/assets/js/109.4fb13502.js"><link rel="prefetch" href="/assets/js/11.ef0fbdd8.js"><link rel="prefetch" href="/assets/js/110.946daf73.js"><link rel="prefetch" href="/assets/js/111.95f0e03e.js"><link rel="prefetch" href="/assets/js/112.98a59d1d.js"><link rel="prefetch" href="/assets/js/113.98895321.js"><link rel="prefetch" href="/assets/js/114.1419962d.js"><link rel="prefetch" href="/assets/js/115.56e434a8.js"><link rel="prefetch" href="/assets/js/116.4765eee1.js"><link rel="prefetch" href="/assets/js/117.d9b02ff9.js"><link rel="prefetch" href="/assets/js/118.8d75a747.js"><link rel="prefetch" href="/assets/js/119.5e0fde69.js"><link rel="prefetch" href="/assets/js/12.8d7bd029.js"><link rel="prefetch" href="/assets/js/121.5e59bc16.js"><link rel="prefetch" href="/assets/js/122.dd6c6483.js"><link rel="prefetch" href="/assets/js/123.4e0058b3.js"><link rel="prefetch" href="/assets/js/124.85a7df77.js"><link rel="prefetch" href="/assets/js/125.ed53f4a1.js"><link rel="prefetch" href="/assets/js/126.e29f8870.js"><link rel="prefetch" href="/assets/js/127.880c218e.js"><link rel="prefetch" href="/assets/js/128.5a0c7351.js"><link rel="prefetch" href="/assets/js/129.75c5ff63.js"><link rel="prefetch" href="/assets/js/13.3cbeb6a6.js"><link rel="prefetch" href="/assets/js/130.24d04412.js"><link rel="prefetch" href="/assets/js/131.8f9b1fac.js"><link rel="prefetch" href="/assets/js/132.b29f6f24.js"><link rel="prefetch" href="/assets/js/133.83969679.js"><link rel="prefetch" href="/assets/js/14.d29f7e81.js"><link rel="prefetch" href="/assets/js/15.2e4f8cc2.js"><link rel="prefetch" href="/assets/js/16.c2cd40e1.js"><link rel="prefetch" href="/assets/js/17.687de162.js"><link rel="prefetch" href="/assets/js/18.6ec9b542.js"><link rel="prefetch" href="/assets/js/19.c927b9a4.js"><link rel="prefetch" href="/assets/js/20.6802ce4f.js"><link rel="prefetch" href="/assets/js/21.84b3b498.js"><link rel="prefetch" href="/assets/js/22.96d2aead.js"><link rel="prefetch" href="/assets/js/23.de185789.js"><link rel="prefetch" href="/assets/js/24.4c0b05ee.js"><link rel="prefetch" href="/assets/js/25.48031560.js"><link rel="prefetch" href="/assets/js/26.468456c3.js"><link rel="prefetch" href="/assets/js/27.3cbd695a.js"><link rel="prefetch" href="/assets/js/28.8d873306.js"><link rel="prefetch" href="/assets/js/29.9ca430ae.js"><link rel="prefetch" href="/assets/js/3.70818af4.js"><link rel="prefetch" href="/assets/js/30.1a971485.js"><link rel="prefetch" href="/assets/js/31.4e81dcd5.js"><link rel="prefetch" href="/assets/js/32.9f1befb2.js"><link rel="prefetch" href="/assets/js/33.c8bf090d.js"><link rel="prefetch" href="/assets/js/34.42421005.js"><link rel="prefetch" href="/assets/js/35.ee91ee76.js"><link rel="prefetch" href="/assets/js/36.47833f09.js"><link rel="prefetch" href="/assets/js/37.fe7aa186.js"><link rel="prefetch" href="/assets/js/38.c948d014.js"><link rel="prefetch" href="/assets/js/39.07b53ec9.js"><link rel="prefetch" href="/assets/js/4.5017c5ca.js"><link rel="prefetch" href="/assets/js/40.1b706b50.js"><link rel="prefetch" href="/assets/js/41.5bae9676.js"><link rel="prefetch" href="/assets/js/42.759c42f7.js"><link rel="prefetch" href="/assets/js/43.e21776c9.js"><link rel="prefetch" href="/assets/js/44.255279ff.js"><link rel="prefetch" href="/assets/js/45.ef371806.js"><link rel="prefetch" href="/assets/js/46.1e5e7a3d.js"><link rel="prefetch" href="/assets/js/47.e0649606.js"><link rel="prefetch" href="/assets/js/48.a7b8d307.js"><link rel="prefetch" href="/assets/js/49.98e8b139.js"><link rel="prefetch" href="/assets/js/5.9c242416.js"><link rel="prefetch" href="/assets/js/50.9b6aba9e.js"><link rel="prefetch" href="/assets/js/51.25ced686.js"><link rel="prefetch" href="/assets/js/52.312c0c25.js"><link rel="prefetch" href="/assets/js/53.b08c6bb3.js"><link rel="prefetch" href="/assets/js/54.1428e09b.js"><link rel="prefetch" href="/assets/js/55.63a70956.js"><link rel="prefetch" href="/assets/js/56.33203c35.js"><link rel="prefetch" href="/assets/js/57.d09223fc.js"><link rel="prefetch" href="/assets/js/58.4830df32.js"><link rel="prefetch" href="/assets/js/59.e98710ea.js"><link rel="prefetch" href="/assets/js/6.20f6982a.js"><link rel="prefetch" href="/assets/js/60.d24f2249.js"><link rel="prefetch" href="/assets/js/61.abeabf2b.js"><link rel="prefetch" href="/assets/js/62.7bb27154.js"><link rel="prefetch" href="/assets/js/63.b9bb2eb2.js"><link rel="prefetch" href="/assets/js/64.71d50f9d.js"><link rel="prefetch" href="/assets/js/65.d1fc7229.js"><link rel="prefetch" href="/assets/js/66.0532446c.js"><link rel="prefetch" href="/assets/js/67.7463f515.js"><link rel="prefetch" href="/assets/js/68.e40172ab.js"><link rel="prefetch" href="/assets/js/69.d04abfdd.js"><link rel="prefetch" href="/assets/js/7.4c5dac4c.js"><link rel="prefetch" href="/assets/js/70.a9d113fc.js"><link rel="prefetch" href="/assets/js/71.7968de88.js"><link rel="prefetch" href="/assets/js/72.d1402eb1.js"><link rel="prefetch" href="/assets/js/73.524fcfb1.js"><link rel="prefetch" href="/assets/js/74.1be7702b.js"><link rel="prefetch" href="/assets/js/75.64e05663.js"><link rel="prefetch" href="/assets/js/76.d4a0c2fd.js"><link rel="prefetch" href="/assets/js/77.14006f72.js"><link rel="prefetch" href="/assets/js/78.4a236501.js"><link rel="prefetch" href="/assets/js/79.4cca6a09.js"><link rel="prefetch" href="/assets/js/8.6a57f7df.js"><link rel="prefetch" href="/assets/js/80.8cb1a157.js"><link rel="prefetch" href="/assets/js/81.6c432be9.js"><link rel="prefetch" href="/assets/js/82.90e93971.js"><link rel="prefetch" href="/assets/js/83.33fe6367.js"><link rel="prefetch" href="/assets/js/84.a0fb9ac3.js"><link rel="prefetch" href="/assets/js/85.2d9806cf.js"><link rel="prefetch" href="/assets/js/86.4c55855c.js"><link rel="prefetch" href="/assets/js/87.c0b71b3c.js"><link rel="prefetch" href="/assets/js/88.985574a4.js"><link rel="prefetch" href="/assets/js/89.ad80c67a.js"><link rel="prefetch" href="/assets/js/9.e43b9501.js"><link rel="prefetch" href="/assets/js/90.f7586c92.js"><link rel="prefetch" href="/assets/js/91.94d98eef.js"><link rel="prefetch" href="/assets/js/92.28db747e.js"><link rel="prefetch" href="/assets/js/93.3b6b6e43.js"><link rel="prefetch" href="/assets/js/94.f06a3d0a.js"><link rel="prefetch" href="/assets/js/95.0708c378.js"><link rel="prefetch" href="/assets/js/96.847e1946.js"><link rel="prefetch" href="/assets/js/97.f8ec7770.js"><link rel="prefetch" href="/assets/js/98.4b33cebd.js"><link rel="prefetch" href="/assets/js/99.e521633f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b41e82d5.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://image.bozhu12.cc/myblog/Essay/hendImage01.jpg" alt="柏竹" class="logo"> <span class="site-name can-hide">柏竹</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/web/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/other/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/Amway/" class="nav-link">应用推荐</a></li><li class="dropdown-item"><!----> <a href="/say/say2023/" class="nav-link">说说</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friendLink/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://image.bozhu12.cc/myblog/Essay/favicon.ico"> <div class="blogger-info"><h3>柏竹</h3> <span>奋斗柏竹</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/web/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/other/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/Amway/" class="nav-link">应用推荐</a></li><li class="dropdown-item"><!----> <a href="/say/say2023/" class="nav-link">说说</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friendLink/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>认知</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>零碎</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/other/1hg7cc/" class="sidebar-link">Docker</a></li><li><a href="/other/newbing/" class="sidebar-link">无魔法newbing</a></li><li><a href="/posts/3m2zs2/" class="sidebar-link">关于我家必应小姐被阉割那档事</a></li><li><a href="/pages/ae3242/" aria-current="page" class="active sidebar-link">若依框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/ae3242/#ruoyi-generator-生成代码" class="sidebar-link">ruoyi-generator 生成代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#应用" class="sidebar-link">应用</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#配置文件yml" class="sidebar-link">配置文件YML</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#web配置" class="sidebar-link">Web配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#基本信息" class="sidebar-link">基本信息</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#字段信息" class="sidebar-link">字段信息</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#生成信息" class="sidebar-link">生成信息</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/ae3242/#ruoyi-oss-文件模块" class="sidebar-link">ruoyi-oss 文件模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#目录" class="sidebar-link">目录</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#库相关" class="sidebar-link">库相关</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#sql" class="sidebar-link">SQL</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#涉及接口" class="sidebar-link">涉及接口</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#后端" class="sidebar-link">后端</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#上传" class="sidebar-link">上传</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#查询" class="sidebar-link">查询</a></li><li class="sidebar-sub-header level5"><a href="/pages/ae3242/#分页查询" class="sidebar-link">分页查询</a></li><li class="sidebar-sub-header level5"><a href="/pages/ae3242/#指定查询" class="sidebar-link">指定查询</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#下载" class="sidebar-link">下载</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#删除" class="sidebar-link">删除</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#minio配置" class="sidebar-link">minio配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#window" class="sidebar-link">Window</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#linux" class="sidebar-link">Linux</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#ruoyi系统配置" class="sidebar-link">ruoyi系统配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#阿里云" class="sidebar-link">阿里云</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#腾讯云" class="sidebar-link">腾讯云</a></li><li class="sidebar-sub-header level4"><a href="/pages/ae3242/#七牛云" class="sidebar-link">七牛云</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/ae3242/#ruoyi-log-日志模块" class="sidebar-link">ruoyi-log 日志模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#目录-2" class="sidebar-link">目录</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#日志运作" class="sidebar-link">日志运作</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#日志切面" class="sidebar-link">日志切面</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#库相关-2" class="sidebar-link">库相关</a></li><li class="sidebar-sub-header level3"><a href="/pages/ae3242/#后端-2" class="sidebar-link">后端</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/other/#更多" data-v-06225672>更多</a></li><li data-v-06225672><a href="/other/#零碎" data-v-06225672>零碎</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Sanscan12" target="_blank" title="作者" class="beLink" data-v-06225672>Sanscan12</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">若依框架<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="ruoyi-generator-生成代码"><a href="#ruoyi-generator-生成代码" class="header-anchor">#</a> ruoyi-generator 生成代码</h2> <h3 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h3> <p><strong>应用大致步骤</strong></p> <ol><li>导入表</li> <li>设置配置表生成下载</li> <li>导入sql</li> <li>copy 前后端</li> <li>重启项目</li></ol> <p><strong>注意 :</strong></p> <ul><li>每个表必须包含有 : <strong>create_by</strong> , create_time , update_by , update_time 字段 (高亮建议必填)</li> <li>树表 必须包含有 指向指定字段(一般用id) , 用于指向父级数据</li></ul> <h3 id="配置文件yml"><a href="#配置文件yml" class="header-anchor">#</a> 配置文件YML</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># 代码生成</span>
<span class="token key atrule">gen</span><span class="token punctuation">:</span> 
  <span class="token comment"># 作者</span>
  <span class="token key atrule">author</span><span class="token punctuation">:</span> ruoyi
  <span class="token comment"># 默认生成包路径 system 需改成自己的模块名称 如 system monitor tool</span>
  <span class="token key atrule">packageName</span><span class="token punctuation">:</span> com.ruoyi.system
  <span class="token comment"># 自动去除表前缀，默认是false</span>
  <span class="token key atrule">autoRemovePre</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># 表前缀（生成类名不会包含表前缀，多个用逗号分隔）</span>
  <span class="token key atrule">tablePrefix</span><span class="token punctuation">:</span> sys_
</code></pre></div><blockquote><p>根据实际情况修改配置</p></blockquote> <h3 id="web配置"><a href="#web配置" class="header-anchor">#</a> Web配置</h3> <p>每张表生成的固定配置 :</p> <ul><li>基本信息</li> <li>字段信息</li> <li>生成信息</li></ul> <h4 id="基本信息"><a href="#基本信息" class="header-anchor">#</a> 基本信息</h4> <p>无关键信息填写</p> <h4 id="字段信息"><a href="#字段信息" class="header-anchor">#</a> 字段信息</h4> <p><strong>物理类型</strong> =&gt; SQL应用的类型</p> <p><strong>Java类型</strong> =&gt; 对象属性类型</p> <p><strong>Java属性</strong> =&gt; 对象属性名称</p> <p>选定字段是否采用 插入 / 编辑 / 列表 / 查询 =&gt; 新增是否显示 / 编辑是否显示 / 列表是否显示 / 查询字段显示</p> <p><strong>查询方式</strong> : 选中查询后 , 指定SQL查询方式</p> <p><strong>显示类型</strong> : 在 编辑 / 新增 时 , 更加的方便使用</p> <p><strong>必填</strong> : 勾选后 , 插入的时候必须填写</p> <h4 id="生成信息"><a href="#生成信息" class="header-anchor">#</a> 生成信息</h4> <p><strong>单表</strong></p> <p>关注 包路径 / 模块名</p> <p><strong>树表</strong></p> <p>关注 包路径 / 模块名 / 树id字段 / 树父id字段 / 树名</p> <blockquote><p>大量数据不适合使用 , 数据分级主要通过前端分级展示</p></blockquote> <h2 id="ruoyi-oss-文件模块"><a href="#ruoyi-oss-文件模块" class="header-anchor">#</a> ruoyi-oss 文件模块</h2> <h3 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h3> <p>模块包路径 :</p> <ul><li><code>ruoyi-common/ruoyi-common-oss</code></li> <li><code>ruoyi-modules/ruoyi-system</code></li></ul> <h3 id="库相关"><a href="#库相关" class="header-anchor">#</a> 库相关</h3> <h3 id="sql"><a href="#sql" class="header-anchor">#</a> SQL</h3> <p><strong>sys_oss</strong></p> <p>存储文件的相关信息</p> <table><thead><tr><th>字段名</th> <th>类型</th> <th>规则</th> <th>说明</th></tr></thead> <tbody><tr><td>oss_id</td> <td>bigint</td> <td>NOT NULL</td> <td>对象存储主键</td></tr> <tr><td>tenant_id</td> <td>varchar(20)</td> <td>DEFAULT '000000'</td> <td>租户编号</td></tr> <tr><td>file_name</td> <td>varchar(255)</td> <td>NOT NULL DEFAULT ''</td> <td>文件名</td></tr> <tr><td>original_name</td> <td>varchar(255)</td> <td>NOT NULL DEFAULT ''</td> <td>原名</td></tr> <tr><td>file_suffix</td> <td>varchar(10)</td> <td>NOT NULL DEFAULT ''</td> <td>文件后缀名</td></tr> <tr><td>url</td> <td>varchar(500)</td> <td>NOT NULL</td> <td>URL地址</td></tr> <tr><td>create_dept</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>创建部门</td></tr> <tr><td>create_time</td> <td>datetime</td> <td>DEFAULT NULL</td> <td>创建时间</td></tr> <tr><td>create_by</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>上传人</td></tr> <tr><td>update_time</td> <td>datetime</td> <td>DEFAULT NULL</td> <td>更新时间</td></tr> <tr><td>update_by</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>更新人</td></tr> <tr><td>service</td> <td>varchar(20)</td> <td>NOT NULL DEFAULT 'minio'</td> <td>服务商</td></tr></tbody></table> <p><strong>sys_oss_config</strong></p> <p>存储供应商配置信息</p> <table><thead><tr><th>字段名</th> <th>类型</th> <th>规则</th> <th>说明</th></tr></thead> <tbody><tr><td>oss_config_id</td> <td>bigint</td> <td>NOT NULL</td> <td>主建</td></tr> <tr><td>tenant_id</td> <td>varchar(20)</td> <td>DEFAULT '000000'</td> <td>租户编号</td></tr> <tr><td>config_key</td> <td>varchar(20)</td> <td>NOT NULL DEFAULT ''</td> <td>配置key</td></tr> <tr><td>access_key</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>accessKey</td></tr> <tr><td>secret_key</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>秘钥</td></tr> <tr><td>bucket_name</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>桶名称</td></tr> <tr><td>prefix</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>前缀</td></tr> <tr><td>endpoint</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>访问站点</td></tr> <tr><td>domain</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>自定义域名</td></tr> <tr><td>is_https</td> <td>char(1)</td> <td>DEFAULT 'N'</td> <td>是否https(Y=是,N=否)</td></tr> <tr><td>region</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>域</td></tr> <tr><td>access_policy</td> <td>char(1)</td> <td>NOT NULL DEFAULT '1'</td> <td>桶权限类型(0=private 1=public 2=custom)</td></tr> <tr><td>status</td> <td>char(1)</td> <td>DEFAULT '1'</td> <td>是否默认(0=是,1=否)</td></tr> <tr><td>ext1</td> <td>varchar(255)</td> <td>DEFAULT ''</td> <td>扩展字段</td></tr> <tr><td>create_dept</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>创建部门</td></tr> <tr><td>create_by</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>创建者</td></tr> <tr><td>create_time</td> <td>datetime</td> <td>DEFAULT NULL</td> <td>创建时间</td></tr> <tr><td>update_by</td> <td>bigint</td> <td>DEFAULT NULL</td> <td>更新者</td></tr> <tr><td>update_time</td> <td>datetime</td> <td>DEFAULT NULL</td> <td>更新时间</td></tr> <tr><td>remark</td> <td>varchar(500)</td> <td>DEFAULT NULL</td> <td>备注</td></tr></tbody></table> <h3 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h3> <p>如果启动了租户功能 , 那前缀是租户的ID , 例如 000000:sys_oss</p> <table><thead><tr><th style="text-align:center;">类型</th> <th style="text-align:center;">key</th> <th style="text-align:center;">val</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">hash</td> <td style="text-align:center;">sys_oss_config</td> <td style="text-align:center;">{configKey , &lt;oss配置信息&gt;}</td> <td style="text-align:center;">存储所有oss相关配置信息</td></tr> <tr><td style="text-align:center;">string</td> <td style="text-align:center;">sys_oss:default_config</td> <td style="text-align:center;">mino</td> <td style="text-align:center;">选中的oss</td></tr> <tr><td style="text-align:center;">hash</td> <td style="text-align:center;">sys_oss</td> <td style="text-align:center;">{}</td> <td style="text-align:center;"></td></tr></tbody></table> <blockquote><p>configKey 配置是指 {&quot;aliyun&quot;, &quot;qcloud&quot;, &quot;qiniu&quot;, &quot;obs&quot;,&quot;mino&quot;} oss供应商</p></blockquote> <h3 id="涉及接口"><a href="#涉及接口" class="header-anchor">#</a> 涉及接口</h3> <table><thead><tr><th>接口</th> <th>说明</th></tr></thead> <tbody><tr><td>GET /resource/oss/list</td> <td>分页查询</td></tr> <tr><td>GET /system/config/configKey/{configKey}</td> <td>预览开关</td></tr> <tr><td>POST /resource/oss/upload</td> <td>文件上传</td></tr> <tr><td>GET /resource/oss/listByIds/{ossIds}</td> <td>文件查询</td></tr> <tr><td>DEL /resource/oss/{ossId}</td> <td>文件删除</td></tr> <tr><td>GET /resource/oss/download/{ossId}</td> <td>文件下载</td></tr></tbody></table> <h3 id="后端"><a href="#后端" class="header-anchor">#</a> 后端</h3> <h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <p><strong>初始化运行 <em>SysOssConfigServiceImpl.init()</em></strong></p> <ol><li>项目运行调用 init()</li> <li>获取SQL库 所有的 oss配置</li> <li>将启用 oss供应商 的存储到 Redis <code>sys_oss:default_config</code></li> <li>将所有 oss配置存储缓存 缓存组 <code>sys_oss_config</code> , key为 ConfigKey , val为 对象JOSN存储</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssConfig</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">TenantHelper</span><span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssConfig</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByAsc</span><span class="token punctuation">(</span><span class="token class-name">TenantEntity</span><span class="token operator">::</span><span class="token function">getTenantId</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SysOssConfig</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">StreamUtils</span><span class="token punctuation">.</span><span class="token function">groupByKey</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token class-name">SysOssConfig</span><span class="token operator">::</span><span class="token function">getTenantId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> tenantId <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TenantHelper</span><span class="token punctuation">.</span><span class="token function">setDynamic</span><span class="token punctuation">(</span>tenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 加载OSS初始化配置</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SysOssConfig</span> config <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tenantId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> configKey <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getConfigKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">RedisUtils</span><span class="token punctuation">.</span><span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token class-name">OssConstant</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CONFIG_KEY</span><span class="token punctuation">,</span> configKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">CacheUtils</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheNames</span><span class="token punctuation">.</span><span class="token constant">SYS_OSS_CONFIG</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getConfigKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">TenantHelper</span><span class="token punctuation">.</span><span class="token function">clearDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="上传"><a href="#上传" class="header-anchor">#</a> 上传</h4> <p><strong>上传 <em>SysOssController.upload()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 上传OSS对象存储
 *
 * @param file 文件
 */</span>
<span class="token annotation punctuation">@SaCheckPermission</span><span class="token punctuation">(</span><span class="token string">&quot;system:oss:upload&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;OSS对象存储&quot;</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span><span class="token constant">INSERT</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span> consumes <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA_VALUE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssUploadVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;上传文件不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 主要存储</span>
    <span class="token class-name">SysOssVo</span> oss <span class="token operator">=</span> ossService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SysOssUploadVo</span> uploadVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysOssUploadVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadVo<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>oss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadVo<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>oss<span class="token punctuation">.</span><span class="token function">getOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uploadVo<span class="token punctuation">.</span><span class="token function">setOssId</span><span class="token punctuation">(</span>oss<span class="token punctuation">.</span><span class="token function">getOssId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>uploadVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>上传具体实现 <em>SysOssServiceImpl.upload()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SysOssVo</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// </span>
    <span class="token class-name">String</span> originalfileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> suffix <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>originalfileName<span class="token punctuation">,</span> originalfileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> originalfileName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取 oss实例 </span>
    <span class="token class-name">OssClient</span> storage <span class="token operator">=</span> <span class="token class-name">OssFactory</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UploadResult</span> uploadResult<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        uploadResult <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">uploadSuffix</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 保存文件信息</span>
    <span class="token class-name">SysOss</span> oss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oss<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>uploadResult<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oss<span class="token punctuation">.</span><span class="token function">setFileSuffix</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oss<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>uploadResult<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oss<span class="token punctuation">.</span><span class="token function">setOriginalName</span><span class="token punctuation">(</span>originalfileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oss<span class="token punctuation">.</span><span class="token function">setService</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span><span class="token function">getConfigKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    baseMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>oss<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SysOssVo</span> sysOssVo <span class="token operator">=</span> <span class="token class-name">MapstructUtils</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>oss<span class="token punctuation">,</span> <span class="token class-name">SysOssVo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">matchingUrl</span><span class="token punctuation">(</span>sysOssVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>具体实现 <em>OssFactory.instance()</em></strong></p> <p>工厂类获取 oss实例</p> <ol><li>获取选中的oss (configKey) , 在Redis获取缓存 <code>sys_oss:default_config</code></li> <li>获取缓存中 oss配置信息 . 根据 configKey 得到手</li> <li>获取实例对象 , 在缓存中进行获取 , 根据出租的ID区分oss实例</li> <li>缓存中为空 , 新建实例并且</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 获取默认实例
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">OssClient</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取redis 默认类型</span>
    <span class="token class-name">String</span> configKey <span class="token operator">=</span> <span class="token class-name">RedisUtils</span><span class="token punctuation">.</span><span class="token function">getCacheObject</span><span class="token punctuation">(</span><span class="token class-name">OssConstant</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CONFIG_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>configKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OssException</span><span class="token punctuation">(</span><span class="token string">&quot;文件存储服务类型无法找到!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span>configKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 根据类型获取实例
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">OssClient</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token class-name">String</span> configKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token class-name">CacheUtils</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CacheNames</span><span class="token punctuation">.</span><span class="token constant">SYS_OSS_CONFIG</span><span class="token punctuation">,</span> configKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OssException</span><span class="token punctuation">(</span><span class="token string">&quot;系统异常, '&quot;</span> <span class="token operator">+</span> configKey <span class="token operator">+</span> <span class="token string">&quot;'配置信息不存在!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">OssProperties</span> properties <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">OssProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用租户标识避免多个租户相同key实例覆盖</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getTenantId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> configKey<span class="token punctuation">;</span>
    <span class="token class-name">OssClient</span> client <span class="token operator">=</span> <span class="token constant">CLIENT_CACHE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">CLIENT_CACHE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OssClient</span><span class="token punctuation">(</span>configKey<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;创建OSS实例 key =&gt; {}&quot;</span><span class="token punctuation">,</span> configKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">CLIENT_CACHE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 配置不相同则重新构建</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>client<span class="token punctuation">.</span><span class="token function">checkPropertiesSame</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">CLIENT_CACHE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OssClient</span><span class="token punctuation">(</span>configKey<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;重载OSS实例 key =&gt; {}&quot;</span><span class="token punctuation">,</span> configKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">CLIENT_CACHE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> client<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h4> <h5 id="分页查询"><a href="#分页查询" class="header-anchor">#</a> 分页查询</h5> <p><strong>分页查询 <em>SysOssController#list()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 查询OSS对象存储列表
 */</span>
<span class="token annotation punctuation">@SaCheckPermission</span><span class="token punctuation">(</span><span class="token string">&quot;system:oss:list&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">TableDataInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">QueryGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token class-name">SysOssBo</span> bo<span class="token punctuation">,</span> <span class="token class-name">PageQuery</span> pageQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> ossService<span class="token punctuation">.</span><span class="token function">queryPageList</span><span class="token punctuation">(</span>bo<span class="token punctuation">,</span> pageQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>具体实现 <em>SysOssServiceImpl#queryPageList()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">TableDataInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryPageList</span><span class="token punctuation">(</span><span class="token class-name">SysOssBo</span> bo<span class="token punctuation">,</span> <span class="token class-name">PageQuery</span> pageQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOss</span><span class="token punctuation">&gt;</span></span> lqw <span class="token operator">=</span> <span class="token function">buildQueryWrapper</span><span class="token punctuation">(</span>bo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectVoPage</span><span class="token punctuation">(</span>pageQuery<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lqw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> filterResult <span class="token operator">=</span> <span class="token class-name">StreamUtils</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">matchingUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">setRecords</span><span class="token punctuation">(</span>filterResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">TableDataInfo</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 封装 约束填充 */</span>
<span class="token keyword">private</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOss</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildQueryWrapper</span><span class="token punctuation">(</span><span class="token class-name">SysOssBo</span> bo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOss</span><span class="token punctuation">&gt;</span></span> lqw <span class="token operator">=</span> <span class="token class-name">Wrappers</span><span class="token punctuation">.</span><span class="token function">lambdaQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getFileName</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getOriginalName</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getFileSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getFileSuffix</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getFileSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getUrl</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;beginCreateTime&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;endCreateTime&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;beginCreateTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;endCreateTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getCreateBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getCreateBy</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getCreateBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lqw<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>bo<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysOss</span><span class="token operator">::</span><span class="token function">getService</span><span class="token punctuation">,</span> bo<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> lqw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>URL路径填充 <em>SysOssServiceImpl.matchingUrl()</em></strong></p> <p>一般情况下 oss存储是私有的 , 无法访问 , 需要特定的方法进行访问 , 因此需要调用此方法匹配填充url</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 匹配Url
 *
 * @param oss OSS对象
 * @return oss 匹配Url的OSS对象
 */</span>
<span class="token keyword">private</span> <span class="token class-name">SysOssVo</span> <span class="token function">matchingUrl</span><span class="token punctuation">(</span><span class="token class-name">SysOssVo</span> oss<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">OssClient</span> storage <span class="token operator">=</span> <span class="token class-name">OssFactory</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span>oss<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> oss<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 仅修改桶类型为 private 的URL，临时URL时长为180s(3min)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AccessPolicyType</span><span class="token punctuation">.</span><span class="token constant">PRIVATE</span> <span class="token operator">==</span> storage<span class="token punctuation">.</span><span class="token function">getAccessPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oss<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span><span class="token function">getPrivateUrl</span><span class="token punctuation">(</span>oss<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> oss<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="指定查询"><a href="#指定查询" class="header-anchor">#</a> 指定查询</h5> <p><strong>查询 <em>SysOssController.listByIds()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 查询OSS对象基于id串
 *
 * @param ossIds OSS对象ID串
 */</span>
<span class="token annotation punctuation">@SaCheckPermission</span><span class="token punctuation">(</span><span class="token string">&quot;system:oss:list&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/listByIds/{ossIds}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">listByIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;主键不能为空&quot;</span><span class="token punctuation">)</span>
                                   <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ossIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> ossService<span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>ossIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>查询具体实现 <em>SysOssServiceImpl.listByIds()</em></strong></p> <p>获取本类的代理对象 SpringUtils.getAopProxy(this) , 实现外部调用本身getById()方法 , 触发缓存注解 @Cacheable(cacheNames = CacheNames.SYS_OSS, key = &quot;#ossId&quot;)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">listByIds</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ossIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOssVo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> id <span class="token operator">:</span> ossIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysOssVo</span> vo <span class="token operator">=</span> <span class="token class-name">SpringUtils</span><span class="token punctuation">.</span><span class="token function">getAopProxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">matchingUrl</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* 当查询数据时, 会优先查缓存是否存在 */</span>
<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token class-name">CacheNames</span><span class="token punctuation">.</span><span class="token constant">SYS_OSS</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#ossId&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SysOssVo</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> ossId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectVoById</span><span class="token punctuation">(</span>ossId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="下载"><a href="#下载" class="header-anchor">#</a> 下载</h4> <p><strong>下载接口 <em>SysOssController.download()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 下载OSS对象
 *
 * @param ossId OSS对象ID
 */</span>
<span class="token annotation punctuation">@SaCheckPermission</span><span class="token punctuation">(</span><span class="token string">&quot;system:oss:download&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/download/{ossId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> ossId<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    ossService<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>ossId<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>具体实现 <em>SysOssServiceImpl.download()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">Long</span> ossId<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">SysOssVo</span> sysOss <span class="token operator">=</span> <span class="token class-name">SpringUtils</span><span class="token punctuation">.</span><span class="token function">getAopProxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>ossId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>sysOss<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;文件数据不存在!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 响应头编码</span>
    <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">setAttachmentResponseHeader</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> sysOss<span class="token punctuation">.</span><span class="token function">getOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM_VALUE</span> <span class="token operator">+</span> <span class="token string">&quot;; charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OssClient</span> storage <span class="token operator">=</span> <span class="token class-name">OssFactory</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getObjectContent</span><span class="token punctuation">(</span>sysOss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> available <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IoUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> available<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span>available<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>文件处理工具 <em>FileUtils.setAttachmentResponseHeader()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 下载文件名重新编码
 *
 * @param response     响应对象
 * @param realFileName 真实文件名
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setAttachmentResponseHeader</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> realFileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> percentEncodedFileName <span class="token operator">=</span> <span class="token function">percentEncode</span><span class="token punctuation">(</span>realFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contentDispositionValue <span class="token operator">=</span> <span class="token string">&quot;attachment; filename=%s;filename*=utf-8''%s&quot;</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span>percentEncodedFileName<span class="token punctuation">,</span> percentEncodedFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Expose-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Disposition,download-filename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-disposition&quot;</span><span class="token punctuation">,</span> contentDispositionValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;download-filename&quot;</span><span class="token punctuation">,</span> percentEncodedFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h4> <p><strong>删除接口 <em>SysOssController.remove()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 删除OSS对象存储
 *
 * @param ossIds OSS对象ID串
 */</span>
<span class="token annotation punctuation">@SaCheckPermission</span><span class="token punctuation">(</span><span class="token string">&quot;system:oss:remove&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;OSS对象存储&quot;</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{ossIds}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;主键不能为空&quot;</span><span class="token punctuation">)</span>
                      <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ossIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">toAjax</span><span class="token punctuation">(</span>ossService<span class="token punctuation">.</span><span class="token function">deleteWithValidByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>ossIds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>删除具体实现 <em>SysOssServiceImpl.deleteWithValidByIds()</em></strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">deleteWithValidByIds</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 做一些业务上的校验,判断是否需要校验</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOss</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectBatchIds</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SysOss</span> sysOss <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OssClient</span> storage <span class="token operator">=</span> <span class="token class-name">OssFactory</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span>sysOss<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        storage<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>sysOss<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> baseMapper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="minio配置"><a href="#minio配置" class="header-anchor">#</a> minio配置</h3> <p><strong>官方下载 :</strong> <a href="https://www.minio.org.cn/download.shtml" target="_blank" rel="noopener noreferrer">https://www.minio.org.cn/download.shtml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="window"><a href="#window" class="header-anchor">#</a> Window</h4> <ol><li><p>下载minio服务端 <code>minio.exe</code></p></li> <li><p>命令运行</p> <div class="language-bash extra-class"><pre class="language-bash"><code>minio.exe server D:<span class="token punctuation">\</span>minio<span class="token punctuation">\</span>store --console-address <span class="token string">&quot;127.0.0.1:9000&quot;</span>  <span class="token parameter variable">--address</span> <span class="token string">&quot;127.0.0.1:9090&quot;</span>
</code></pre></div><blockquote><p>指定存储路径 : <code>D:\minio\store</code></p> <p>指定控制台访问地址 : <code>--console-address &quot;127.0.0.1:9000&quot;</code></p> <p>指定API访问地址 : <code>--address &quot;127.0.0.1:9090&quot;</code></p></blockquote></li> <li><p>在窗口可以看到 账号密码进入即可</p></li> <li><p>新建用户 . 记住 账号和密码</p></li> <li><p>创建 空间桶 . 侧栏 -&gt; Buckets -&gt; Create Bucket -&gt; 自行配置... (记住桶名称)</p></li></ol> <h4 id="linux"><a href="#linux" class="header-anchor">#</a> Linux</h4> <p>下载 <a href="https://www.minio.org.cn/download.shtml#/linux" target="_blank" rel="noopener noreferrer">https://www.minio.org.cn/download.shtml#/linux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>新建 minio目录(根目录) <code>mkdir -p /opt/minio</code> =&gt; <code>cd /opt/minio</code></p></li> <li><p>新建存储路径 <code>mkdir data</code></p></li> <li><p>下载minio <code>wget https://dl.minio.org.cn/server/minio/release/linux-amd64/minio</code></p></li> <li><p>开放权限 <code>chmod +x minio</code> ; <code>chmod a+rw data</code></p></li> <li><p>创建 配置文件 <code>vim /opt/minio/conf/minio.conf</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">MINIO_VOLUMES</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">/opt/minio/data</span>&quot;</span>
<span class="token key attr-name">MINIO_ROOT_USER</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">ruoyi</span>&quot;</span>
<span class="token key attr-name">MINIO_ROOT_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">ruoyi123123</span>&quot;</span>
</code></pre></div></li> <li><p>创建service 启动脚本文件 <code>vim /lib/systemd/system/minio.service</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>MinIO
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://docs.min.io
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target
<span class="token assign-left variable">AssertFileIsExecutable</span><span class="token operator">=</span>/opt/minio/minio

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">WorkingDirectory</span><span class="token operator">=</span>/opt/minio

<span class="token assign-left variable">EnvironmentFile</span><span class="token operator">=</span>/opt/minio/conf/minio.conf
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;if [ -z <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">${MINIO_VOLUMES}</span><span class="token entity" title="\&quot;">\&quot;</span> ]; then echo <span class="token entity" title="\&quot;">\&quot;</span>Variable MINIO_VOLUMES not set in /opt/minio/conf/minio.conf<span class="token entity" title="\&quot;">\&quot;</span>; exit 1; fi&quot;</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/opt/minio/minio server --console-address <span class="token string">&quot;0.0.0.0:9000&quot;</span>  <span class="token parameter variable">--address</span> <span class="token string">&quot;0.0.0.0:9090&quot;</span> <span class="token variable">$MINIO_VOLUMES</span>

<span class="token comment"># Let systemd restart this service always</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always

<span class="token comment"># Specifies the maximum file descriptor number that can be opened by this process</span>
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">65536</span>

<span class="token comment"># Specifies the maximum number of threads this process can create</span>
<span class="token assign-left variable">TasksMax</span><span class="token operator">=</span>infinity

<span class="token comment"># Disable timeout logic and wait until process is stopped</span>
<span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">SendSIGKILL</span><span class="token operator">=</span>no

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token comment"># Built for ${project.name}-${project.version} (${project.name})</span>
</code></pre></div></li> <li><p>服务控制</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 每次开机启动</span>
systemctl <span class="token builtin class-name">enable</span> minio.service
<span class="token comment"># 启动服务</span>
systemctl start minio
<span class="token comment"># 停止服务</span>
systemctl stop minio
<span class="token comment"># 查看服务状态</span>
systemctl status minio
<span class="token comment"># ....</span>
</code></pre></div></li> <li><p>访问即可 <code>http://&lt;IP地址&gt;:9000</code> (注意开放端口)</p></li></ol> <div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>防火墙打开 9000 , 9090 端口 / 关闭防火墙</li> <li>云服务器 , 开放安全组 9000 , 9090 端口</li></ul></div> <h4 id="ruoyi系统配置"><a href="#ruoyi系统配置" class="header-anchor">#</a> ruoyi系统配置</h4> <p>侧栏 -&gt; 文件管理 -&gt; 配置管理 -&gt; 选择<code>minio</code>编辑</p> <table><thead><tr><th style="text-align:center;">配置项</th> <th style="text-align:center;">值</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">配置Key</td> <td style="text-align:center;">Minio</td> <td style="text-align:center;">供应商</td></tr> <tr><td style="text-align:center;">访问站点</td> <td style="text-align:center;">127.0.0.1:9090</td> <td style="text-align:center;">外部访问的API地址</td></tr> <tr><td style="text-align:center;">自定义域名</td> <td style="text-align:center;"></td> <td style="text-align:center;">访问API域名</td></tr> <tr><td style="text-align:center;">access Key</td> <td style="text-align:center;">ruoyi</td> <td style="text-align:center;">创建的账户名</td></tr> <tr><td style="text-align:center;">secretKey</td> <td style="text-align:center;">ruoyi123</td> <td style="text-align:center;">创建的用户密码</td></tr> <tr><td style="text-align:center;">桶名称</td> <td style="text-align:center;">test</td> <td style="text-align:center;">新建空间桶名称</td></tr> <tr><td style="text-align:center;">桶类型</td> <td style="text-align:center;">private</td> <td style="text-align:center;">私有类</td></tr> <tr><td style="text-align:center;">前缀</td> <td style="text-align:center;">image</td> <td style="text-align:center;">图片地址附加前缀</td></tr> <tr><td style="text-align:center;">开启HTTPS</td> <td style="text-align:center;">否</td> <td style="text-align:center;">API地址HTTPS?</td></tr> <tr><td style="text-align:center;">域</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr></tbody></table> <h4 id="阿里云"><a href="#阿里云" class="header-anchor">#</a> 阿里云</h4> <h4 id="腾讯云"><a href="#腾讯云" class="header-anchor">#</a> 腾讯云</h4> <h4 id="七牛云"><a href="#七牛云" class="header-anchor">#</a> 七牛云</h4> <h2 id="ruoyi-log-日志模块"><a href="#ruoyi-log-日志模块" class="header-anchor">#</a> ruoyi-log 日志模块</h2> <h3 id="目录-2"><a href="#目录-2" class="header-anchor">#</a> 目录</h3> <p>模块包路径 : <code>ruoyi-common/ruoyi-common-log</code></p> <p>系统模块包路径 : <code>ruoyi-modules/ruoyi-system</code></p> <h3 id="日志运作"><a href="#日志运作" class="header-anchor">#</a> 日志运作</h3> <p><strong>运作大体流程 :</strong></p> <ol><li><p>Controller层 @Log注解方法 被 切面类LogAspect拦截</p></li> <li><p>前置处理 , 方法业务执行前 , 记录当前时间戳</p></li> <li><p>后置处理 , 方法业务执行后 , 记录方法类型等相关信息</p> <p>记录信息 : 租户id , 请求ip , 请求状态 , 请求url , 请求方法 , 接口类方法 , 请求方式 , 请求参数 , ...</p></li> <li><p>时间戳记录运行过程时长</p></li> <li><p>发布事件监听 , 异步存储数据库</p></li> <li><p>API获取IP城市地址 , 并封装存储</p></li> <li><p>写入数据库</p></li></ol> <h3 id="日志切面"><a href="#日志切面" class="header-anchor">#</a> 日志切面</h3> <p>日志通知会根据Controller层的方法携带有 <code>@Log</code> 注解实现</p> <ol><li>@Before 前置通知 : 记录当前时间戳</li> <li>@AfterReturning 后置通知 : 记录日志信息</li> <li>@AfterThrowing 异常通知 : 记录异常信息</li></ol> <h3 id="库相关-2"><a href="#库相关-2" class="header-anchor">#</a> 库相关</h3> <p><strong>sys_logininfor</strong> 日志存储表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_logininfor<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>info_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'访问ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'000000'</span> <span class="token keyword">COMMENT</span> <span class="token string">'租户编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户账号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>ipaddr<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'登录IP地址'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>login_location<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'登录地点'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>browser<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'浏览器类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>os<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作系统'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'登录状态（0成功 1失败）'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>msg<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'提示消息'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>login_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'访问时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>info_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_sys_logininfor_s<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_sys_logininfor_lt<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>login_time<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'系统访问记录'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="后端-2"><a href="#后端-2" class="header-anchor">#</a> 后端</h3> <p><strong>@Log注解</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 自定义操作日志记录注解
 *
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Log</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 模块
     */</span>
    <span class="token class-name">String</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 功能
     */</span>
    <span class="token class-name">BusinessType</span> <span class="token function">businessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span><span class="token constant">OTHER</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 操作人类别
     */</span>
    <span class="token class-name">OperatorType</span> <span class="token function">operatorType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">OperatorType</span><span class="token punctuation">.</span><span class="token constant">MANAGE</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 是否保存请求的参数
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">isSaveRequestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 是否保存响应的参数
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">isSaveResponseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 排除指定的请求参数
     */</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeParamNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>LogAspect切面类</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 操作日志记录处理
 *
 * @author Lion Li
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@AutoConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspect</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 排除敏感属性字段
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">EXCLUDE_PROPERTIES</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oldPassword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;newPassword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmPassword&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 计算操作消耗时间
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StopWatch</span><span class="token punctuation">&gt;</span></span> <span class="token constant">TIME_THREADLOCAL</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransmittableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 处理请求前执行
     */</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;@annotation(controllerLog)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">boBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Log</span> controllerLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">TIME_THREADLOCAL</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 处理完请求后执行
     *
     * @param joinPoint 切点
     */</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">&quot;@annotation(controllerLog)&quot;</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">&quot;jsonResult&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterReturning</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Log</span> controllerLog<span class="token punctuation">,</span> <span class="token class-name">Object</span> jsonResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleLog</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">,</span> controllerLog<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> jsonResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 拦截异常操作
     *
     * @param joinPoint 切点
     * @param e         异常
     */</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;@annotation(controllerLog)&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Log</span> controllerLog<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleLog</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">,</span> controllerLog<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handleLog</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Log</span> controllerLog<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">Object</span> jsonResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment">// *========数据库日志=========*//</span>
            <span class="token class-name">OperLogEvent</span> operLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OperLogEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setTenantId</span><span class="token punctuation">(</span><span class="token class-name">LoginHelper</span><span class="token punctuation">.</span><span class="token function">getTenantId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">BusinessStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 请求的地址</span>
            <span class="token class-name">String</span> ip <span class="token operator">=</span> <span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getClientIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setOperIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setOperUrl</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setOperName</span><span class="token punctuation">(</span><span class="token class-name">LoginHelper</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                operLog<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">BusinessStatus</span><span class="token punctuation">.</span><span class="token constant">FAIL</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                operLog<span class="token punctuation">.</span><span class="token function">setErrorMsg</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 设置方法名称</span>
            <span class="token class-name">String</span> className <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> methodName <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span>className <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token string">&quot;()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置请求方式</span>
            operLog<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 处理设置注解上的参数</span>
            <span class="token function">getControllerMethodDescription</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">,</span> controllerLog<span class="token punctuation">,</span> operLog<span class="token punctuation">,</span> jsonResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置消耗时间</span>
            <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token constant">TIME_THREADLOCAL</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setCostTime</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 发布事件保存数据库</span>
            <span class="token class-name">SpringUtils</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span>operLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 记录本地异常日志</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;异常信息:{}&quot;</span><span class="token punctuation">,</span> exp<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exp<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token constant">TIME_THREADLOCAL</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取注解中对方法的描述信息 用于Controller层注解
     *
     * @param log     日志
     * @param operLog 操作日志
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getControllerMethodDescription</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Log</span> log<span class="token punctuation">,</span> <span class="token class-name">OperLogEvent</span> operLog<span class="token punctuation">,</span> <span class="token class-name">Object</span> jsonResult<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置action动作</span>
        operLog<span class="token punctuation">.</span><span class="token function">setBusinessType</span><span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">businessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置标题</span>
        operLog<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置操作人类别</span>
        operLog<span class="token punctuation">.</span><span class="token function">setOperatorType</span><span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">operatorType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 是否需要保存request，参数和值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isSaveRequestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取参数的信息，传入到数据库中。</span>
            <span class="token function">setRequestValue</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">,</span> operLog<span class="token punctuation">,</span> log<span class="token punctuation">.</span><span class="token function">excludeParamNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 是否需要保存response，参数和值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isSaveResponseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>jsonResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            operLog<span class="token punctuation">.</span><span class="token function">setJsonResult</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>jsonResult<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取请求的参数，放到log中
     *
     * @param operLog 操作日志
     * @throws Exception 异常
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setRequestValue</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">OperLogEvent</span> operLog<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> excludeParamNames<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> paramsMap <span class="token operator">=</span> <span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getParamMap</span><span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> requestMethod <span class="token operator">=</span> operLog<span class="token punctuation">.</span><span class="token function">getRequestMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>paramsMap<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>requestMethod<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>requestMethod<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> params <span class="token operator">=</span> <span class="token function">argsArrayToString</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> excludeParamNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setOperParam</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">removeAny</span><span class="token punctuation">(</span>paramsMap<span class="token punctuation">,</span> <span class="token constant">EXCLUDE_PROPERTIES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">removeAny</span><span class="token punctuation">(</span>paramsMap<span class="token punctuation">,</span> excludeParamNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
            operLog<span class="token punctuation">.</span><span class="token function">setOperParam</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>paramsMap<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 参数拼装
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">argsArrayToString</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramsArray<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> excludeParamNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>paramsArray <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> paramsArray<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> paramsArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isFilterObject</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Dict</span> dict <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">parseMap</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">removeAny</span><span class="token punctuation">(</span>dict<span class="token punctuation">,</span> <span class="token constant">EXCLUDE_PROPERTIES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">removeAny</span><span class="token punctuation">(</span>dict<span class="token punctuation">,</span> excludeParamNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            str <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 判断是否需要过滤的对象。
     * &lt;p&gt;
     * 意图 : 过滤掉文件上传请求
     * @param o 对象信息。
     * @return 如果是需要过滤的对象，则返回true；否则返回false。
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isFilterObject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> clazz<span class="token punctuation">.</span><span class="token function">getComponentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Collection</span> collection <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> value <span class="token operator">:</span> collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> value <span class="token keyword">instanceof</span> <span class="token class-name">MultipartFile</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> value <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> entry <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
                <span class="token keyword">return</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">MultipartFile</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> o <span class="token keyword">instanceof</span> <span class="token class-name">MultipartFile</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">HttpServletRequest</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">HttpServletResponse</span>
            <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">BindingResult</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/posts/3m2zs2/" class="prev">关于我家必应小姐被阉割那档事</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/web/wcs13x/"><div>
            Vue3
            <!----></div></a> <span class="date">11-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/ruoyi-vue-plus/02/"><div>
            Ruoyi-Vue-Plus 工具篇
            <!----></div></a> <span class="date">11-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/ruoyi-vue-plus/03/"><div>
            Ruoyi-Vue-Plus 框架整合篇
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="Sanscan12" title="联系" target="_blank" class="iconfont icon-weixin"></a><a href="https://github.com/Sanscan12" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/user/home?id=448156561" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span> | <a href="https://beian.miit.gov.cn/">桂ICP备2022009417号-1</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.19d69fa3.js" defer></script><script src="/assets/js/2.b26d2d6f.js" defer></script><script src="/assets/js/120.3df76986.js" defer></script>
  </body>
</html>
